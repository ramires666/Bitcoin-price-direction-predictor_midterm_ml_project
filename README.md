# üîÆ Bitcoin Price Direction Classifier

> "The market is a pendulum that forever swings between unsustainable optimism (which makes stocks too expensive) and unjustified pessimism (which makes them too cheap). The intelligent investor is a realist who sells to optimists and buys from pessimists." - Benjamin Graham

## üìñ Introduction

Trading cryptocurrencies is a high-stakes game that attracts millions with the promise of unlimited upside. But for every winner, there are countless losers. The difference often boils down to one thing: **information**.

Imagine having a "magic ball" that doesn't just guess, but scientifically analyzes the market's hidden states. That's what we've built.

This project isn't just another technical indicator. It's a sophisticated machine learning system that combines:
1.  **"Oracle" Labeling**: We use a zero-lag smoothing technique to define the "true" trend, training our model on what *actually* happened, not just lagging indicators.
2.  **Advanced Feature Engineering**: We generate hundreds of technical indicators across multiple categories (Momentum, Trend, Volatility, Volume, Overlap, Statistics, Candles).
3.  **Automated Feature Selection**: The training pipeline intelligently selects the optimal combination of indicator groups and the top-k most important features to maximize accuracy and reduce noise.
4.  **XGBoost Classification**: We use a powerful gradient boosting model tuned via Randomized Search with Walk-Forward Validation to predict market direction.

## üõ†Ô∏è Project Structure

*   **`train.py`**: The brain of the operation. It performs a full AutoML pipeline:
    *   Loads data and generates Oracle targets.
    *   Iteratively tests combinations of indicator groups (e.g., Momentum + Volatility).
    *   Selects the top-k best features based on importance.
    *   Tunes XGBoost hyperparameters using RandomizedSearchCV and TimeSeriesSplit.
    *   Saves the best model and the list of selected features to `models/`.
*   **`predict.py`**: The inference engine. Loads the trained model and the list of best features to generate predictions for new data.
*   **`app.py`**: A FastAPI web service that connects to Binance, fetches live data, caches it in a local database, and serves up fresh predictions.
*   **`midterm_project_bitcoin_price_direction_classificator__III.py`**: The advanced research script detailing the entire journey from data analysis to the final optimized pipeline.

## ‚ö° How to Run

### Prerequisites

You'll need **Docker** and **Docker Compose** installed. That's it! We've containerized everything for your convenience.

### 1. Get the Data
The project relies on historical data (Parquet files) located in `data/processed/`. These are generated by the scripts in `data/` (e.g., `downloader.py`, `parsing_*.py`). Ensure you have this data before training.

### 2. Train the Model

Before you can predict, you must train. You can do this locally or inside the container.

**Option A: Locally (with Conda)**
```bash
conda env create -f environment.yml
conda activate xgb_fints_project
python train.py
```
*Note: If you encounter OpenMP/KMeans crashes on Windows, try Option B.*

**Option B: Inside Docker (Recommended for Windows)**
If you have issues running locally, you can run the training script inside the Docker container:

1. Build the image:
```bash
docker build -t xgb_fints_project .
```

2. Run the training script (choose your OS):

**Windows (PowerShell):**
```powershell
docker run --rm -v ${PWD}:/app xgb_fints_project python train.py
```

**Windows (Command Prompt):**
```cmd
docker run --rm -v %cd%:/app xgb_fints_project python train.py
```

**Linux / macOS:**
```bash
docker run --rm -v $(pwd):/app xgb_fints_project python train.py
```

This will create a `models/` directory with the trained artifacts (`best_xgb_model.joblib`, `best_features_list.json`, etc.).

### 3. Launch the Web Service üöÄ
Spin up the prediction service with a single command:

```bash
docker-compose up --build
```

The service will start on **port 11111**.

### 4. Get Predictions!
Open your browser and go to:
üëâ **http://localhost:11111**

You'll see a simple interface. Click **"Update Data & Predict"** to fetch the latest market data from Binance and consult the Oracle.

## ‚òÅÔ∏è Deployment to Google Cloud Run

Want to take it to the cloud? Here is a step-by-step guide to deploying this service to Google Cloud Run.

### 1. One-time Project Setup

Initialize your Google Cloud environment and enable the necessary services:

```bash
gcloud init
gcloud auth login
gcloud config set project YOUR_PROJECT_ID
gcloud services enable run.googleapis.com artifactregistry.googleapis.com
```

*Note: You can find your `YOUR_PROJECT_ID` in the Google Cloud Console dashboard.*

### 2. Build the Docker Image

Build the image locally (ensure you are in the directory with the `Dockerfile`):

```bash
docker build -t gcr.io/YOUR_PROJECT_ID/webservice .
```

### 3. Push to Container Registry

Configure Docker to authenticate with GCP and push your image:

```bash
gcloud auth configure-docker
docker push gcr.io/YOUR_PROJECT_ID/webservice
```

### 4. Deploy to Cloud Run

Deploy the service to the cloud:

```bash
gcloud run deploy webservice \
  --image gcr.io/YOUR_PROJECT_ID/webservice \
  --platform managed \
  --region europe-central2 \
  --allow-unauthenticated
```

Once completed, you will see a URL like `URL: https://...run.app`. This is your live application address.

---

**Live Demo:**
The service is currently running and accessible here:
üëâ **https://webservice-732860276994.europe-central2.run.app/**

## üìä Backtesting Results
Our research shows that while regression fails miserably ($R^2 \approx 0$), classification is viable. By filtering for high-confidence setups and understanding market regimes, the model demonstrates predictive power significantly better than a coin flip (~69% accuracy on test data).

---
*Disclaimer: This is a research project, not financial advice. Trading cryptocurrencies involves significant risk. Use this "magic ball" responsibly!* üòâ